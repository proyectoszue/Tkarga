<odoo>
    <data>
        <record model="ir.actions.act_window" id="zue_purchase.account_move_action">
            <field name="name">Legalizaci贸n de recursos econ贸micos</field>
            <field name="res_model">account.move</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('type', '=', 'in_invoice'), ('is_rcm', '=', True)]</field>
            <field name="context">{'default_type': 'in_invoice', 'default_is_rcm': True}</field>
        </record>

        <record model='ir.ui.view' id='view_zue_purchase_tree_account_move'>
            <field name="name">zue_purchase.account_move_tree_inherit</field>
            <field name="model">account.move</field>
            <field name="priority">40</field>
			<field name="inherit_id" ref="account.view_invoice_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//tree[1]/field[@name='state']" position="after">
                    <field name="sre_order_id"/>
                </xpath>
            </field>
        </record>

		<record id="view_zue_purchase_form_account_move" model="ir.ui.view">
			<field name="name">zue_account.account_move_inherit</field>
			<field name="model">account.move</field>
			<field name="priority">30</field>
			<field name="inherit_id" ref="account.view_move_form"/>
			<field name="arch" type="xml">

                <xpath expr="//field[@name='ref']" position="after">					
                    <field name="sre_order_id" attrs="{'invisible': ['|',('is_rcm', '=', False),('is_refund', '=', True)],'required':[('is_rcm', '=', True),('is_refund', '=', False)]}"/> 
                    <field name="is_rcm" invisible="1"/>
                    <field name="is_refund" invisible="1"/>
                </xpath>

                <xpath expr="//form[1]/sheet[1]/group[1]/group[1]/field[@name='partner_id']" position="attributes">
                    <attribute name="attrs">{"invisible": [["type","not in",["out_invoice","out_refund","in_invoice","in_refund","out_receipt","in_receipt"]]], "readonly": [["state","not in",["draft"]]]}</attribute>
                </xpath>

                <xpath expr="//field[@name='supplier_invoice_number']" position="attributes">
                    <attribute name="attrs">{"invisible": ["|",["type","!=","in_invoice"],["is_rcm","=",True]], "required": ["&amp;",["type","=","in_invoice"],["is_rcm","=",False]]}</attribute>
                </xpath>
                <xpath expr="//field[@name='purchase_vendor_bill_id']" position="attributes">
                    <attribute name="attrs">{"invisible": ["|","|","|",["state","not in",["draft"]],["state","=","purchase"],["type","!=","in_invoice"],["is_rcm","=",True]], "readonly": [["state","not in",["draft"]]]}</attribute>
                </xpath>
                <!-- <xpath expr="//field[@name='invoice_payment_term_id']" position="attributes">
                    <attribute name="attrs">{"invisible": ["|",["type","not in",["out_invoice","out_refund","in_invoice","in_refund","out_receipt","in_receipt"]],["is_rcm","=",True]], "readonly": [["state","not in",["draft"]]]}</attribute>
                </xpath>
                <xpath expr="//label[@for='invoice_payment_term_id']" position="attributes">
                    <attribute name="attrs">{"invisible": ["|",["type","not in",["out_invoice","out_refund","in_invoice","in_refund","out_receipt","in_receipt"]],["is_rcm","=",True]], "readonly": [["state","not in",["draft"]]]}</attribute>
                </xpath> -->
                <xpath expr="//field[@name='supplier_invoice_attachment']" position="attributes">
                    <attribute name="attrs">{"invisible": ["|",["type","!=","in_invoice"],["is_rcm","=",True]], "required": ["&amp;",["type","=","in_invoice"],["is_rcm","=",False]]}</attribute>
                </xpath>


                <xpath expr="//field[@name='invoice_date_due']" position="attributes">
                    <attribute name="attrs">{"invisible": ["|","|",["invoice_payment_term_id","!=",False],["type","not in",["out_invoice","out_refund","in_invoice","in_refund","out_receipt","in_receipt"]],["is_rcm","=",True]], "readonly": [["state","not in",["draft"]]]}</attribute>
                </xpath>
                <xpath expr="//field[@name='invoice_line_ids']" position="attributes">
                    <attribute name="context">"{'default_type': context.get('default_type'), 'default_is_rcm': context.get('default_is_rcm'), 'default_is_refund': context.get('default_is_refund'), 'journal_id': journal_id, 'default_partner_id': commercial_partner_id, 'default_currency_id': currency_id != company_currency_id and currency_id or False}"</attribute>
                </xpath>

                <xpath expr="//form[1]/sheet[1]/group[1]" position="after">
                    <group string="Solicitud Recurso Econ贸mico" attrs="{'invisible': ['|',('is_rcm', '=', False),('is_refund', '=', True)]}">
                        <field name="sre_order_move_id" attrs="{'invisible': ['|',('is_rcm', '=', False),('is_refund', '=', True)]}" nolabel="1">
                            <tree>
                                <field name="name"/>
                                <field name="account_analytic_id"/>
                                <field name="qty"/>
                                <field name="amount"/>
                                <field name="taxes_id" widget="many2many_tags"/>
                                <field name="amount_total" readonly="1"/>
                            </tree>
                        </field>
                    </group>
                    <group class="oe_subtotal_footer" attrs="{'invisible': ['|',('is_rcm', '=', False),('is_refund', '=', True)]}" >
                        <field name="sre_order_move_amount_untaxed"/>
                        <field name="sre_order_move_amount_tax"/>
                        <field name="sre_order_move_amount_total" class="oe_subtotal_footer_separator"/>
                    </group>
                    <group string="Legalizaci贸n" attrs="{'invisible': [('is_rcm', '=', False),('is_refund', '=', True)]}"/>
                </xpath>

                <xpath expr="//field[@name='invoice_line_ids']" position="attributes">
                    <attribute name="attrs">{"readonly": ["|",["state","not in",["draft"]],"&amp;","&amp;",["is_rcm","=",True],["sre_order_id","=",False],["is_refund","=",False]]}</attribute>
                </xpath>
  
                <xpath expr="//form[1]/sheet[1]/notebook[1]/page[1]/field[@name='invoice_line_ids']/tree[1]/field[@name='name']" position="after">
                    <field name="partner_id"  invisible="context.get('default_is_rcm') == None"/>
                </xpath>

                <xpath expr="//form[1]/sheet[1]/notebook[1]/page[1]/field[@name='invoice_line_ids']/tree[1]/field[@name='analytic_account_id']" position="attributes">
                    <attribute name="attrs">{"required": [["required_analytic_account","=",True]]}</attribute>
                </xpath>
                <xpath expr="//form[1]/sheet[1]/notebook[1]/page[1]/field[@name='invoice_line_ids']/tree[1]/field[@name='partner_id']" position="attributes">
                    <attribute name="attrs">{"required": [["required_partner","=",True]]}</attribute>
                </xpath>

                <xpath expr="//form[1]/sheet[1]/notebook[1]/page[1]/field[@name='invoice_line_ids']/tree[1]/field[@name='price_subtotal']" position="after">
                    <field name="rcm_document"  invisible="context.get('default_is_rcm') == None" force_save="True"/>
                </xpath>

                <xpath expr="//form[1]/sheet[1]/notebook[1]/page[2]/field[@name='line_ids']/tree[1]/field[@name='partner_id']" position="before">
                    <field name="rcm_document" invisible="1"/>
                </xpath>
			</field>
		</record> 
    </data>
</odoo>